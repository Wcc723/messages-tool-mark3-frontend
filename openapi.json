{
  "openapi": "3.0.0",
  "info": {
    "title": "Discord 自動化排程訊息工具 API",
    "version": "1.0.0",
    "description": "Discord 自動化排程訊息工具的 RESTful API 文件",
    "contact": {
      "name": "API Support",
      "email": "support@example.com"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "開發環境"
    },
    {
      "url": "https://api.example.com",
      "description": "正式環境"
    }
  ],
  "paths": {
    "/api/admin/dashboard": {
      "get": {
        "summary": "取得管理員儀表板資料",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功取得儀表板資料"
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "權限不足"
          },
          "500": {
            "description": "伺服器錯誤"
          }
        }
      }
    },
    "/api/admin/users": {
      "get": {
        "summary": "取得所有使用者列表",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "default": 20
            }
          },
          {
            "in": "query",
            "name": "role",
            "schema": {
              "type": "string",
              "enum": [
                "admin",
                "manager",
                "no_permission"
              ],
              "description": "super_admin 角色只能透過環境變數設定"
            }
          },
          {
            "in": "query",
            "name": "search",
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "isActive",
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功取得使用者列表"
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "權限不足"
          },
          "500": {
            "description": "伺服器錯誤"
          }
        }
      }
    },
    "/api/admin/users/{id}": {
      "get": {
        "summary": "取得特定使用者詳情",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功取得使用者詳情"
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "權限不足"
          },
          "404": {
            "description": "使用者不存在"
          },
          "500": {
            "description": "伺服器錯誤"
          }
        }
      },
      "put": {
        "summary": "更新使用者資料",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "isActive": {
                    "type": "boolean"
                  },
                  "scheduleLimit": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "使用者資料更新成功"
          },
          "400": {
            "description": "請求資料錯誤"
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "權限不足"
          },
          "404": {
            "description": "使用者不存在"
          },
          "500": {
            "description": "伺服器錯誤"
          }
        }
      },
      "delete": {
        "summary": "刪除使用者",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "使用者刪除成功"
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "權限不足"
          },
          "404": {
            "description": "使用者不存在"
          },
          "500": {
            "description": "伺服器錯誤"
          }
        }
      }
    },
    "/api/admin/users/{id}/role": {
      "put": {
        "summary": "更新使用者角色",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "role"
                ],
                "properties": {
                  "role": {
                    "type": "string",
                    "enum": [
                      "admin",
                      "manager",
                      "no_permission"
                    ],
                    "description": "super_admin 角色只能透過環境變數 SUPER_ADMIN_EMAILS 設定，無法透過 API 賦予"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "使用者角色更新成功"
          },
          "400": {
            "description": "請求資料錯誤"
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "權限不足"
          },
          "404": {
            "description": "使用者不存在"
          },
          "500": {
            "description": "伺服器錯誤"
          }
        }
      }
    },
    "/api/admin/schedules": {
      "get": {
        "summary": "取得所有排程列表",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "default": 20
            }
          },
          {
            "in": "query",
            "name": "status",
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "userId",
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "in": "query",
            "name": "search",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功取得所有排程"
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "權限不足"
          },
          "500": {
            "description": "伺服器錯誤"
          }
        }
      }
    },
    "/api/admin/system-logs": {
      "get": {
        "summary": "取得系統日誌",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "default": 50
            }
          },
          {
            "in": "query",
            "name": "status",
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "userId",
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "in": "query",
            "name": "scheduleId",
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "in": "query",
            "name": "startDate",
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          },
          {
            "in": "query",
            "name": "endDate",
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功取得系統日誌"
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "權限不足"
          },
          "500": {
            "description": "伺服器錯誤"
          }
        }
      }
    },
    "/api/admin/permissions": {
      "get": {
        "summary": "取得權限配置資訊",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功取得權限配置資訊"
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "權限不足"
          },
          "500": {
            "description": "伺服器錯誤"
          }
        }
      }
    },
    "/api/admin/permissions/reload": {
      "post": {
        "summary": "重新載入權限配置（僅 Super Admin）",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "權限配置重新載入成功"
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "權限不足（僅 Super Admin）"
          },
          "500": {
            "description": "伺服器錯誤"
          }
        }
      }
    },
    "/api/admin/roles/assignable": {
      "get": {
        "summary": "取得可賦予的角色列表",
        "description": "根據當前使用者的角色，返回該使用者可以賦予給其他使用者的角色列表",
        "tags": [
          "Admin"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功取得可賦予的角色列表",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "currentRole": {
                          "type": "string"
                        },
                        "assignableRoles": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "value": {
                                "type": "string"
                              },
                              "label": {
                                "type": "string"
                              },
                              "description": {
                                "type": "string"
                              }
                            }
                          }
                        },
                        "note": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "權限不足"
          },
          "500": {
            "description": "伺服器錯誤"
          }
        }
      }
    },
    "/api/auth/register": {
      "post": {
        "summary": "使用者註冊",
        "tags": [
          "Authentication"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RegisterRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "註冊成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                }
              }
            }
          },
          "400": {
            "description": "註冊資料錯誤"
          }
        }
      }
    },
    "/api/auth/login": {
      "post": {
        "summary": "使用者登入",
        "tags": [
          "Authentication"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "登入成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                }
              }
            }
          },
          "401": {
            "description": "登入失敗"
          }
        }
      }
    },
    "/api/auth/profile": {
      "get": {
        "summary": "取得使用者個人資料",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功取得個人資料",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/User"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未認證"
          },
          "404": {
            "description": "使用者不存在"
          }
        }
      },
      "put": {
        "summary": "更新使用者個人資料",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "使用者姓名"
                  },
                  "avatar": {
                    "type": "string",
                    "description": "使用者頭像 URL"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "更新成功"
          },
          "400": {
            "description": "更新資料錯誤"
          },
          "401": {
            "description": "未認證"
          }
        }
      }
    },
    "/api/auth/password": {
      "put": {
        "summary": "修改密碼",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "currentPassword",
                  "newPassword",
                  "confirmPassword"
                ],
                "properties": {
                  "currentPassword": {
                    "type": "string",
                    "description": "目前密碼"
                  },
                  "newPassword": {
                    "type": "string",
                    "minLength": 6,
                    "description": "新密碼 (至少 6 字元)"
                  },
                  "confirmPassword": {
                    "type": "string",
                    "description": "確認新密碼"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "密碼修改成功"
          },
          "400": {
            "description": "密碼修改資料錯誤"
          },
          "401": {
            "description": "未認證"
          }
        }
      }
    },
    "/api/auth/refresh": {
      "post": {
        "summary": "刷新認證 Token",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Token 刷新成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                }
              }
            }
          },
          "401": {
            "description": "Refresh Token 無效或過期"
          }
        }
      }
    },
    "/api/auth/google": {
      "get": {
        "summary": "啟動 Google OAuth 登入流程",
        "tags": [
          "Authentication"
        ],
        "responses": {
          "302": {
            "description": "重導向到 Google 登入頁面"
          }
        }
      },
      "post": {
        "summary": "驗證前端 Google ID Token",
        "tags": [
          "Authentication"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "googleToken"
                ],
                "properties": {
                  "googleToken": {
                    "type": "string",
                    "description": "Google ID Token"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Google 登入成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                }
              }
            }
          },
          "400": {
            "description": "請求資料錯誤"
          },
          "401": {
            "description": "Google Token 無效"
          }
        }
      }
    },
    "/api/auth/google/callback": {
      "get": {
        "summary": "Google OAuth 回調端點",
        "tags": [
          "Authentication"
        ],
        "responses": {
          "302": {
            "description": "重導向到前端應用程式"
          }
        }
      }
    },
    "/api/auth/logout": {
      "post": {
        "summary": "使用者登出",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "登出成功"
          },
          "401": {
            "description": "未認證"
          }
        }
      }
    },
    "/api/discord/validate-token": {
      "get": {
        "summary": "驗證 Discord Bot 連接狀態",
        "tags": [
          "Discord"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Bot 連接正常",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "valid": {
                          "type": "boolean"
                        },
                        "botUser": {
                          "$ref": "#/components/schemas/DiscordBot"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "連接失敗"
          },
          "401": {
            "description": "未認證"
          },
          "500": {
            "description": "伺服器未設定 Bot Token"
          }
        }
      }
    },
    "/api/discord/guilds": {
      "get": {
        "summary": "取得 Bot 加入的 Discord 伺服器列表",
        "tags": [
          "Discord"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功取得伺服器列表",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "guilds": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/DiscordGuild"
                          }
                        },
                        "count": {
                          "type": "integer"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "獲取失敗"
          },
          "401": {
            "description": "未認證"
          },
          "500": {
            "description": "伺服器未設定 Bot Token"
          }
        }
      }
    },
    "/api/discord/guilds/{guildId}/channels": {
      "get": {
        "summary": "取得指定伺服器的頻道列表",
        "tags": [
          "Discord"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "guildId",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Discord 伺服器 ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "token"
                ],
                "properties": {
                  "token": {
                    "type": "string",
                    "description": "Discord Bot Token"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "成功取得頻道列表",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "guildId": {
                          "type": "string"
                        },
                        "channels": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/DiscordChannel"
                          }
                        },
                        "count": {
                          "type": "integer"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "參數錯誤或獲取失敗"
          },
          "401": {
            "description": "未認證"
          }
        }
      }
    },
    "/api/discord/channels": {
      "get": {
        "summary": "取得預設伺服器的頻道列表",
        "tags": [
          "Discord"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功取得頻道列表",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "guildId": {
                          "type": "string"
                        },
                        "channels": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/DiscordChannel"
                          }
                        },
                        "count": {
                          "type": "integer"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "獲取失敗"
          },
          "401": {
            "description": "未認證"
          },
          "500": {
            "description": "伺服器未設定 Bot Token 或 Guild ID"
          }
        }
      }
    },
    "/api/discord/test-message": {
      "post": {
        "summary": "發送測試訊息",
        "tags": [
          "Discord"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "channelId",
                  "content"
                ],
                "properties": {
                  "channelId": {
                    "type": "string",
                    "description": "Discord 頻道 ID"
                  },
                  "content": {
                    "type": "string",
                    "maxLength": 2000,
                    "description": "測試訊息內容"
                  },
                  "threadConfig": {
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/ThreadConfig"
                      }
                    ],
                    "nullable": true,
                    "description": "子討論串配置（選填）"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "測試訊息發送成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "messageId": {
                          "type": "string",
                          "description": "訊息 ID"
                        },
                        "channelId": {
                          "type": "string",
                          "description": "頻道 ID"
                        },
                        "guildId": {
                          "type": "string",
                          "description": "伺服器 ID"
                        },
                        "content": {
                          "type": "string",
                          "description": "訊息內容"
                        },
                        "timestamp": {
                          "type": "integer",
                          "description": "訊息時間戳記"
                        },
                        "url": {
                          "type": "string",
                          "description": "訊息連結"
                        },
                        "threadId": {
                          "type": "string",
                          "nullable": true,
                          "description": "Thread ID（如果建立了 thread）"
                        },
                        "threadUrl": {
                          "type": "string",
                          "nullable": true,
                          "description": "Thread URL（如果建立了 thread）"
                        },
                        "threadStatus": {
                          "type": "string",
                          "enum": [
                            "success",
                            "failed",
                            "not_configured"
                          ],
                          "description": "Thread 建立狀態"
                        },
                        "threadError": {
                          "type": "string",
                          "nullable": true,
                          "description": "Thread 建立錯誤訊息（如果失敗）"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "參數錯誤或發送失敗"
          },
          "401": {
            "description": "未認證"
          }
        }
      }
    },
    "/api/discord/send-message": {
      "post": {
        "summary": "發送訊息到 Discord 頻道",
        "tags": [
          "Discord"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "channelId",
                  "content"
                ],
                "properties": {
                  "channelId": {
                    "type": "string",
                    "description": "Discord 頻道 ID"
                  },
                  "content": {
                    "type": "string",
                    "maxLength": 2000,
                    "description": "訊息內容"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "訊息發送成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "$ref": "#/components/schemas/DiscordMessage"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "參數錯誤或發送失敗"
          },
          "401": {
            "description": "未認證"
          }
        }
      }
    },
    "/api/discord/bot-info": {
      "get": {
        "summary": "取得 Bot 資訊和連接狀態",
        "tags": [
          "Discord"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功取得 Bot 資訊",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "bot": {
                          "$ref": "#/components/schemas/DiscordBot"
                        },
                        "guildCount": {
                          "type": "integer",
                          "description": "Bot 加入的伺服器數量"
                        },
                        "status": {
                          "type": "string",
                          "description": "連接狀態"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "連接失敗"
          },
          "401": {
            "description": "未認證"
          },
          "500": {
            "description": "伺服器未設定 Bot Token"
          }
        }
      }
    },
    "/api/images/all": {
      "get": {
        "summary": "列出所有圖片（不限使用者）",
        "tags": [
          "Images"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer",
              "default": 1
            },
            "description": "頁碼"
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "default": 20
            },
            "description": "每頁筆數"
          },
          {
            "in": "query",
            "name": "userId",
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "篩選特定使用者的圖片"
          },
          {
            "in": "query",
            "name": "scheduleId",
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "篩選特定排程的圖片"
          },
          {
            "in": "query",
            "name": "includeDeleted",
            "schema": {
              "type": "boolean",
              "default": false
            },
            "description": "是否包含已刪除的圖片"
          }
        ],
        "responses": {
          "200": {
            "description": "成功取得所有圖片列表"
          },
          "401": {
            "description": "未認證"
          },
          "500": {
            "description": "伺服器錯誤"
          }
        }
      }
    },
    "/api/images": {
      "get": {
        "summary": "列出圖片（團隊存取）",
        "description": "Super Admin/Admin/Manager 可查看所有圖片，支援 userId 參數篩選特定使用者的圖片",
        "tags": [
          "Images"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer",
              "default": 1
            },
            "description": "頁碼"
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "default": 20
            },
            "description": "每頁筆數"
          },
          {
            "in": "query",
            "name": "userId",
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "篩選特定使用者的圖片 (Super Admin/Admin/Manager 可用)"
          },
          {
            "in": "query",
            "name": "scheduleId",
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "篩選特定排程的圖片"
          },
          {
            "in": "query",
            "name": "includeDeleted",
            "schema": {
              "type": "boolean",
              "default": false
            },
            "description": "是否包含已刪除的圖片"
          }
        ],
        "responses": {
          "200": {
            "description": "成功取得圖片列表",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "total": {
                          "type": "integer"
                        },
                        "page": {
                          "type": "integer"
                        },
                        "limit": {
                          "type": "integer"
                        },
                        "totalPages": {
                          "type": "integer"
                        },
                        "images": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string",
                                "format": "uuid"
                              },
                              "fileName": {
                                "type": "string"
                              },
                              "publicUrl": {
                                "type": "string"
                              },
                              "discordUrl": {
                                "type": "string"
                              },
                              "fileSize": {
                                "type": "integer"
                              },
                              "mimeType": {
                                "type": "string"
                              },
                              "uploadedAt": {
                                "type": "string",
                                "format": "date-time"
                              },
                              "schedule": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "string",
                                    "format": "uuid"
                                  },
                                  "title": {
                                    "type": "string"
                                  }
                                }
                              },
                              "discordMessageId": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未認證"
          },
          "500": {
            "description": "伺服器錯誤"
          }
        }
      }
    },
    "/api/images/{id}": {
      "get": {
        "summary": "取得圖片詳細資訊",
        "tags": [
          "Images"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "圖片 ID"
          }
        ],
        "responses": {
          "200": {
            "description": "成功取得圖片詳情",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "fileName": {
                          "type": "string"
                        },
                        "filePath": {
                          "type": "string"
                        },
                        "publicUrl": {
                          "type": "string"
                        },
                        "discordUrl": {
                          "type": "string"
                        },
                        "fileSize": {
                          "type": "integer"
                        },
                        "mimeType": {
                          "type": "string"
                        },
                        "uploadedAt": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "deletedAt": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "discordMessageId": {
                          "type": "string"
                        },
                        "schedule": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string",
                              "format": "uuid"
                            },
                            "title": {
                              "type": "string"
                            },
                            "content": {
                              "type": "string"
                            },
                            "channelId": {
                              "type": "string"
                            },
                            "status": {
                              "type": "string"
                            }
                          }
                        },
                        "executionLog": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string",
                              "format": "uuid"
                            },
                            "executedAt": {
                              "type": "string",
                              "format": "date-time"
                            },
                            "status": {
                              "type": "string"
                            },
                            "discordMessageId": {
                              "type": "string"
                            },
                            "message": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "無權限存取"
          },
          "404": {
            "description": "圖片不存在"
          },
          "500": {
            "description": "伺服器錯誤"
          }
        }
      },
      "delete": {
        "summary": "刪除單一圖片（權限控制）",
        "description": "Super Admin/Admin 可刪除任何圖片，Manager 僅能刪除自己的圖片",
        "tags": [
          "Images"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "圖片 ID"
          }
        ],
        "responses": {
          "200": {
            "description": "圖片刪除成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "請求資料錯誤（如圖片已被刪除）"
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "無權限刪除此圖片"
          },
          "404": {
            "description": "圖片不存在"
          },
          "500": {
            "description": "刪除失敗"
          }
        }
      }
    },
    "/api/images/batch-delete": {
      "post": {
        "summary": "批次刪除圖片（權限控制）",
        "description": "Super Admin/Admin 可刪除任何圖片，Manager 僅能刪除自己的圖片",
        "tags": [
          "Images"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "imageIds"
                ],
                "properties": {
                  "imageIds": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "description": "要刪除的圖片 ID 陣列",
                    "example": [
                      "uuid1",
                      "uuid2",
                      "uuid3"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "批次刪除完成",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "success": {
                          "type": "integer",
                          "description": "成功刪除的數量"
                        },
                        "failed": {
                          "type": "integer",
                          "description": "失敗的數量"
                        },
                        "errors": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "imageId": {
                                "type": "string",
                                "format": "uuid"
                              },
                              "error": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "請求資料錯誤"
          },
          "401": {
            "description": "未認證"
          },
          "500": {
            "description": "刪除失敗"
          }
        }
      }
    },
    "/api/schedules": {
      "post": {
        "summary": "創建新排程",
        "tags": [
          "Schedules"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ScheduleRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "排程創建成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Schedule"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "請求資料錯誤"
          },
          "401": {
            "description": "未認證"
          }
        }
      },
      "get": {
        "summary": "取得排程列表（團隊存取）",
        "description": "Super Admin/Admin/Manager 可查看所有排程，支援 userId 參數篩選特定使用者的排程",
        "tags": [
          "Schedules"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer",
              "default": 1
            },
            "description": "頁碼"
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "default": 10
            },
            "description": "每頁筆數"
          },
          {
            "in": "query",
            "name": "status",
            "schema": {
              "type": "string",
              "enum": [
                "draft",
                "active",
                "paused",
                "completed"
              ]
            },
            "description": "篩選排程狀態"
          },
          {
            "in": "query",
            "name": "search",
            "schema": {
              "type": "string"
            },
            "description": "搜尋關鍵字 (搜尋標題和內容)"
          },
          {
            "in": "query",
            "name": "userId",
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "篩選特定使用者的排程 (Super Admin/Admin/Manager 可用)"
          }
        ],
        "responses": {
          "200": {
            "description": "取得排程列表成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "schedules": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/Schedule"
                          }
                        },
                        "pagination": {
                          "type": "object",
                          "properties": {
                            "currentPage": {
                              "type": "integer"
                            },
                            "totalPages": {
                              "type": "integer"
                            },
                            "totalCount": {
                              "type": "integer"
                            },
                            "limit": {
                              "type": "integer"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未認證"
          }
        }
      }
    },
    "/api/schedules/timezones": {
      "get": {
        "summary": "取得支援的時區列表",
        "tags": [
          "Schedules"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "取得時區列表成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Timezone"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未認證"
          }
        }
      }
    },
    "/api/schedules/{id}": {
      "get": {
        "summary": "取得特定排程詳情（團隊存取）",
        "description": "Super Admin/Admin/Manager 都可讀取任何排程",
        "tags": [
          "Schedules"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "排程 ID"
          }
        ],
        "responses": {
          "200": {
            "description": "取得排程詳情成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Schedule"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "無權限存取此排程"
          },
          "404": {
            "description": "排程不存在"
          }
        }
      },
      "patch": {
        "summary": "部分更新排程（權限控制）",
        "description": "Super Admin/Admin 可修改任何排程，Manager 僅能修改自己的排程",
        "tags": [
          "Schedules"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "排程 ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "description": "部分更新排程，只需提供要修改的欄位",
                "properties": {
                  "title": {
                    "type": "string",
                    "maxLength": 100,
                    "description": "排程名稱"
                  },
                  "content": {
                    "type": "string",
                    "maxLength": 2000,
                    "description": "訊息內容"
                  },
                  "scheduleType": {
                    "type": "string",
                    "enum": [
                      "once",
                      "weekly",
                      "monthly"
                    ],
                    "description": "排程類型"
                  },
                  "scheduledTime": {
                    "type": "string",
                    "format": "time",
                    "description": "排程時間 (HH:mm:ss 格式)",
                    "example": "09:00:00"
                  },
                  "scheduledDate": {
                    "type": "string",
                    "format": "date",
                    "description": "單次排程日期 (僅 scheduleType=once 時需要)",
                    "example": "2024-12-25"
                  },
                  "weekDay": {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 6,
                    "description": "週幾 (僅 scheduleType=weekly 時需要, 0=週日, 6=週六)",
                    "example": 1
                  },
                  "monthDay": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 31,
                    "description": "每月幾號 (僅 scheduleType=monthly 時需要)",
                    "example": 15
                  },
                  "channelId": {
                    "type": "string",
                    "description": "Discord 頻道 ID"
                  },
                  "timezone": {
                    "type": "string",
                    "description": "時區設定",
                    "enum": [
                      "Asia/Taipei",
                      "Asia/Tokyo",
                      "Asia/Shanghai",
                      "UTC",
                      "America/New_York",
                      "Europe/London"
                    ]
                  },
                  "validUntil": {
                    "type": "string",
                    "format": "date-time",
                    "nullable": true,
                    "description": "排程有效期限\n- 週排程和月排程不可設為 null\n- 單次排程可設為 null 清除期限\n",
                    "example": "2025-12-31T23:59:59Z"
                  },
                  "status": {
                    "type": "string",
                    "enum": [
                      "draft",
                      "active",
                      "paused",
                      "completed",
                      "expired"
                    ],
                    "description": "排程狀態"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "排程更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Schedule"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "請求資料錯誤"
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "無權限修改此排程"
          },
          "404": {
            "description": "排程不存在"
          }
        }
      },
      "delete": {
        "summary": "刪除排程（權限控制）",
        "description": "Super Admin/Admin 可刪除任何排程，Manager 僅能刪除自己的排程",
        "tags": [
          "Schedules"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "排程 ID"
          }
        ],
        "responses": {
          "200": {
            "description": "排程刪除成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "無權限刪除此排程"
          },
          "404": {
            "description": "排程不存在"
          }
        }
      }
    },
    "/api/schedules/{id}/status": {
      "patch": {
        "summary": "更新排程狀態（權限控制）",
        "description": "Super Admin/Admin 可修改任何排程狀態，Manager 僅能修改自己的排程",
        "tags": [
          "Schedules"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "排程 ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "status"
                ],
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": [
                      "draft",
                      "active",
                      "paused",
                      "completed",
                      "expired"
                    ],
                    "description": "新的排程狀態"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "排程狀態更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Schedule"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "請求資料錯誤"
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "無權限修改此排程狀態"
          },
          "404": {
            "description": "排程不存在"
          }
        }
      }
    },
    "/api/schedules/{id}/logs": {
      "get": {
        "summary": "取得排程執行記錄（團隊存取）",
        "description": "Super Admin/Admin/Manager 都可讀取任何排程的執行記錄",
        "tags": [
          "Schedules"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "排程 ID"
          },
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer",
              "default": 1
            },
            "description": "頁碼"
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "default": 20
            },
            "description": "每頁筆數"
          }
        ],
        "responses": {
          "200": {
            "description": "取得執行記錄成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "logs": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/ExecutionLog"
                          }
                        },
                        "pagination": {
                          "type": "object",
                          "properties": {
                            "currentPage": {
                              "type": "integer"
                            },
                            "totalPages": {
                              "type": "integer"
                            },
                            "totalCount": {
                              "type": "integer"
                            },
                            "limit": {
                              "type": "integer"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "無權限存取此排程"
          },
          "404": {
            "description": "排程不存在"
          }
        }
      }
    },
    "/api/storage/upload-image": {
      "post": {
        "summary": "上傳圖片至 Firebase Storage",
        "tags": [
          "Storage"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": [
                  "image"
                ],
                "properties": {
                  "image": {
                    "type": "string",
                    "format": "binary",
                    "description": "圖片檔案（PNG, JPG, JPEG, GIF, WEBP，最大 5MB）"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "圖片上傳成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "imageId": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "publicUrl": {
                          "type": "string"
                        },
                        "filePath": {
                          "type": "string"
                        },
                        "fileName": {
                          "type": "string"
                        },
                        "fileSize": {
                          "type": "integer"
                        },
                        "mimeType": {
                          "type": "string"
                        },
                        "uploadedAt": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "請求資料錯誤"
          },
          "401": {
            "description": "未認證"
          },
          "500": {
            "description": "上傳失敗"
          }
        }
      }
    },
    "/api/storage/images/{filePath}": {
      "delete": {
        "summary": "刪除 Firebase Storage 圖片",
        "tags": [
          "Storage"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "filePath",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Firebase Storage 檔案路徑（需 URL encode）"
          }
        ],
        "responses": {
          "200": {
            "description": "圖片刪除成功"
          },
          "401": {
            "description": "未認證"
          },
          "403": {
            "description": "無權限刪除"
          },
          "404": {
            "description": "圖片不存在"
          },
          "500": {
            "description": "刪除失敗"
          }
        }
      }
    },
    "/api/users/profile": {
      "get": {
        "summary": "取得個人資料",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "成功取得個人資料"
          },
          "401": {
            "description": "未認證"
          },
          "500": {
            "description": "伺服器錯誤"
          }
        }
      },
      "put": {
        "summary": "更新個人資料",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "avatar": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "個人資料更新成功"
          },
          "400": {
            "description": "請求資料錯誤"
          },
          "401": {
            "description": "未認證"
          },
          "500": {
            "description": "伺服器錯誤"
          }
        }
      }
    },
    "/api/users/account": {
      "delete": {
        "summary": "刪除個人帳號",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "password": {
                    "type": "string",
                    "description": "若有設定密碼，需提供密碼確認"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "帳號刪除成功"
          },
          "400": {
            "description": "請求資料錯誤"
          },
          "401": {
            "description": "未認證或密碼錯誤"
          },
          "403": {
            "description": "無權限刪除（如 Super Admin）"
          },
          "500": {
            "description": "伺服器錯誤"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "description": "使用者唯一識別碼"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "使用者電子郵件"
          },
          "name": {
            "type": "string",
            "description": "使用者姓名"
          },
          "role": {
            "type": "string",
            "enum": [
              "admin",
              "user"
            ],
            "description": "使用者角色"
          },
          "avatar": {
            "type": "string",
            "description": "使用者頭像 URL"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "建立時間"
          }
        }
      },
      "LoginRequest": {
        "type": "object",
        "required": [
          "email",
          "password"
        ],
        "properties": {
          "email": {
            "type": "string",
            "format": "email",
            "description": "電子郵件"
          },
          "password": {
            "type": "string",
            "description": "密碼"
          }
        }
      },
      "RegisterRequest": {
        "type": "object",
        "required": [
          "email",
          "password",
          "name"
        ],
        "properties": {
          "email": {
            "type": "string",
            "format": "email",
            "description": "電子郵件"
          },
          "password": {
            "type": "string",
            "minLength": 6,
            "description": "密碼 (至少 6 字元)"
          },
          "name": {
            "type": "string",
            "description": "使用者姓名"
          }
        }
      },
      "AuthResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "message": {
            "type": "string"
          },
          "data": {
            "type": "object",
            "properties": {
              "user": {
                "$ref": "#/components/schemas/User"
              },
              "token": {
                "type": "string",
                "description": "JWT 認證令牌"
              },
              "refreshToken": {
                "type": "string",
                "description": "JWT 刷新令牌"
              },
              "expiresAt": {
                "type": "string",
                "format": "date-time",
                "description": "Token 過期時間"
              }
            }
          }
        }
      },
      "DiscordBot": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Bot 用戶 ID"
          },
          "username": {
            "type": "string",
            "description": "Bot 用戶名稱"
          },
          "discriminator": {
            "type": "string",
            "description": "Bot 識別碼"
          },
          "avatar": {
            "type": "string",
            "description": "Bot 頭像 ID"
          }
        }
      },
      "DiscordGuild": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "伺服器 ID"
          },
          "name": {
            "type": "string",
            "description": "伺服器名稱"
          },
          "icon": {
            "type": "string",
            "description": "伺服器圖標 ID"
          },
          "owner": {
            "type": "boolean",
            "description": "Bot 是否為伺服器擁有者"
          },
          "permissions": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Bot 在該伺服器的權限列表"
          },
          "memberCount": {
            "type": "integer",
            "description": "成員數量"
          },
          "description": {
            "type": "string",
            "description": "伺服器描述"
          }
        }
      },
      "DiscordChannel": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "頻道 ID"
          },
          "name": {
            "type": "string",
            "description": "頻道名稱"
          },
          "type": {
            "type": "integer",
            "description": "頻道類型"
          },
          "position": {
            "type": "integer",
            "description": "頻道排序位置"
          },
          "parentId": {
            "type": "string",
            "description": "父分類 ID"
          },
          "topic": {
            "type": "string",
            "description": "頻道主題"
          },
          "nsfw": {
            "type": "boolean",
            "description": "是否為 NSFW 頻道"
          },
          "permissions": {
            "type": "object",
            "properties": {
              "viewChannel": {
                "type": "boolean"
              },
              "sendMessages": {
                "type": "boolean"
              },
              "embedLinks": {
                "type": "boolean"
              },
              "attachFiles": {
                "type": "boolean"
              },
              "mentionEveryone": {
                "type": "boolean"
              }
            }
          }
        }
      },
      "DiscordMessage": {
        "type": "object",
        "properties": {
          "messageId": {
            "type": "string",
            "description": "訊息 ID"
          },
          "channelId": {
            "type": "string",
            "description": "頻道 ID"
          },
          "guildId": {
            "type": "string",
            "description": "伺服器 ID"
          },
          "content": {
            "type": "string",
            "description": "訊息內容"
          },
          "timestamp": {
            "type": "integer",
            "description": "訊息時間戳記"
          },
          "url": {
            "type": "string",
            "description": "訊息連結"
          }
        }
      },
      "Schedule": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "description": "排程唯一識別碼"
          },
          "userId": {
            "type": "string",
            "format": "uuid",
            "description": "使用者 ID"
          },
          "title": {
            "type": "string",
            "description": "排程名稱"
          },
          "content": {
            "type": "string",
            "description": "訊息內容"
          },
          "scheduleType": {
            "type": "string",
            "enum": [
              "once",
              "weekly",
              "monthly"
            ],
            "description": "排程類型"
          },
          "scheduledTime": {
            "type": "string",
            "format": "time",
            "description": "排程時間 (HH:mm:ss)"
          },
          "scheduledDate": {
            "type": "string",
            "format": "date",
            "description": "單次排程日期"
          },
          "weekDay": {
            "type": "integer",
            "minimum": 0,
            "maximum": 6,
            "description": "週幾 (0=週日, 6=週六)"
          },
          "monthDay": {
            "type": "integer",
            "minimum": 1,
            "maximum": 31,
            "description": "月排程日期"
          },
          "channelId": {
            "type": "string",
            "description": "Discord 頻道 ID"
          },
          "timezone": {
            "type": "string",
            "description": "時區設定",
            "default": "Asia/Taipei"
          },
          "attachments": {
            "type": "object",
            "nullable": true,
            "description": "附件資料",
            "properties": {
              "images": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "imageId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "firebaseUrl": {
                      "type": "string"
                    },
                    "filePath": {
                      "type": "string"
                    },
                    "fileName": {
                      "type": "string"
                    },
                    "fileSize": {
                      "type": "integer"
                    },
                    "mimeType": {
                      "type": "string"
                    },
                    "uploadedAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "discordUrl": {
                      "type": "string",
                      "nullable": true
                    }
                  }
                }
              }
            }
          },
          "threadConfig": {
            "allOf": [
              {
                "$ref": "#/components/schemas/ThreadConfig"
              }
            ],
            "nullable": true,
            "description": "子討論串配置"
          },
          "validUntil": {
            "type": "string",
            "format": "date-time",
            "nullable": true,
            "description": "排程有效期限。週排程和月排程必填，單次排程選填"
          },
          "status": {
            "type": "string",
            "enum": [
              "draft",
              "active",
              "paused",
              "completed",
              "expired"
            ],
            "description": "排程狀態 (expired 表示已超過有效期限)"
          },
          "lastExecutedAt": {
            "type": "string",
            "format": "date-time",
            "description": "上次執行時間"
          },
          "nextExecutionAt": {
            "type": "string",
            "format": "date-time",
            "description": "下次執行時間"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "建立時間"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "更新時間"
          }
        }
      },
      "ScheduleRequest": {
        "type": "object",
        "required": [
          "title",
          "content",
          "scheduleType",
          "scheduledTime",
          "channelId"
        ],
        "properties": {
          "title": {
            "type": "string",
            "maxLength": 100,
            "description": "排程名稱"
          },
          "content": {
            "type": "string",
            "maxLength": 2000,
            "description": "訊息內容"
          },
          "scheduleType": {
            "type": "string",
            "enum": [
              "once",
              "weekly",
              "monthly"
            ],
            "description": "排程類型"
          },
          "scheduledTime": {
            "type": "string",
            "format": "time",
            "description": "排程時間 (HH:mm:ss 格式)",
            "example": "09:00:00"
          },
          "scheduledDate": {
            "type": "string",
            "format": "date",
            "description": "單次排程日期 (僅 scheduleType=once 時需要)",
            "example": "2024-12-25"
          },
          "weekDay": {
            "type": "integer",
            "minimum": 0,
            "maximum": 6,
            "description": "週幾 (僅 scheduleType=weekly 時需要, 0=週日, 6=週六)",
            "example": 1
          },
          "monthDay": {
            "type": "integer",
            "minimum": 1,
            "maximum": 31,
            "description": "每月幾號 (僅 scheduleType=monthly 時需要)",
            "example": 15
          },
          "channelId": {
            "type": "string",
            "description": "Discord 頻道 ID"
          },
          "timezone": {
            "type": "string",
            "description": "時區設定",
            "default": "Asia/Taipei",
            "enum": [
              "Asia/Taipei",
              "Asia/Tokyo",
              "Asia/Shanghai",
              "UTC",
              "America/New_York",
              "Europe/London"
            ]
          },
          "validUntil": {
            "type": "string",
            "format": "date-time",
            "description": "排程有效期限 (ISO 8601 格式，UTC 時間)\n- 週排程和月排程: **必填**\n- 單次排程: 選填\n設定後排程將在此時間後自動過期，不再執行\n",
            "example": "2025-12-31T23:59:59Z"
          },
          "attachments": {
            "type": "object",
            "nullable": true,
            "description": "附件資料",
            "properties": {
              "images": {
                "type": "array",
                "items": {
                  "type": "object",
                  "required": [
                    "imageId",
                    "firebaseUrl",
                    "filePath",
                    "fileName",
                    "fileSize",
                    "mimeType",
                    "uploadedAt"
                  ],
                  "properties": {
                    "imageId": {
                      "type": "string",
                      "format": "uuid",
                      "description": "圖片唯一識別碼"
                    },
                    "firebaseUrl": {
                      "type": "string",
                      "description": "Firebase Storage 公開 URL"
                    },
                    "filePath": {
                      "type": "string",
                      "description": "Firebase Storage 檔案路徑"
                    },
                    "fileName": {
                      "type": "string",
                      "description": "檔案名稱"
                    },
                    "fileSize": {
                      "type": "integer",
                      "description": "檔案大小（bytes）"
                    },
                    "mimeType": {
                      "type": "string",
                      "description": "MIME 類型"
                    },
                    "uploadedAt": {
                      "type": "string",
                      "format": "date-time",
                      "description": "上傳時間"
                    },
                    "discordUrl": {
                      "type": "string",
                      "nullable": true,
                      "description": "Discord CDN URL（創建時為 null）"
                    }
                  }
                }
              }
            }
          },
          "threadConfig": {
            "allOf": [
              {
                "$ref": "#/components/schemas/ThreadConfig"
              }
            ],
            "nullable": true,
            "description": "子討論串配置"
          },
          "status": {
            "type": "string",
            "enum": [
              "draft",
              "active"
            ],
            "default": "draft",
            "description": "排程狀態"
          }
        }
      },
      "ExecutionLog": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "description": "執行記錄 ID"
          },
          "scheduleId": {
            "type": "string",
            "format": "uuid",
            "description": "排程 ID"
          },
          "status": {
            "type": "string",
            "enum": [
              "success",
              "failed",
              "pending"
            ],
            "description": "執行狀態"
          },
          "executedAt": {
            "type": "string",
            "format": "date-time",
            "description": "執行時間"
          },
          "message": {
            "type": "string",
            "description": "執行結果訊息"
          },
          "error": {
            "type": "string",
            "description": "錯誤訊息"
          },
          "discordMessageId": {
            "type": "string",
            "description": "Discord 訊息 ID"
          },
          "threadId": {
            "type": "string",
            "nullable": true,
            "description": "Discord Thread ID"
          },
          "threadUrl": {
            "type": "string",
            "nullable": true,
            "description": "Discord Thread URL"
          },
          "threadStatus": {
            "type": "string",
            "enum": [
              "success",
              "failed",
              "skipped",
              "not_configured"
            ],
            "nullable": true,
            "description": "Thread 建立狀態"
          },
          "threadError": {
            "type": "string",
            "nullable": true,
            "description": "Thread 建立錯誤訊息"
          }
        }
      },
      "Timezone": {
        "type": "object",
        "properties": {
          "value": {
            "type": "string",
            "description": "時區識別碼"
          },
          "label": {
            "type": "string",
            "description": "時區顯示名稱"
          },
          "offset": {
            "type": "string",
            "description": "UTC 偏移量"
          }
        }
      },
      "ThreadConfig": {
        "type": "object",
        "required": [
          "enabled"
        ],
        "properties": {
          "enabled": {
            "type": "boolean",
            "description": "是否啟用子討論串功能"
          },
          "title": {
            "type": "string",
            "maxLength": 100,
            "description": "子討論串標題（當 enabled=true 時必填，最多 100 字元）"
          },
          "initialMessage": {
            "type": "string",
            "maxLength": 2000,
            "nullable": true,
            "description": "子討論串初始訊息（選填，最多 2000 字元）"
          }
        },
        "example": {
          "enabled": true,
          "title": "討論區：每週例會",
          "initialMessage": "歡迎在此討論本週例會相關事項"
        }
      }
    },
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  },
  "tags": []
}