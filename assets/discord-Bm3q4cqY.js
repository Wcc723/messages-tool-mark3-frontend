import{y as i,E as G,r as c,c as f}from"./index-2APcEGPh.js";async function x(){return(await i.get("/api/discord/bot-info")).data.data}async function I(){return(await i.get("/api/discord/guilds")).data.data}async function T(){return(await i.get("/api/discord/channels")).data.data}async function B(a,o){return(await i.get(`/api/discord/guilds/${a}/channels`,{data:void 0})).data.data}async function M(a){return a?B(a):T()}async function b(a,o){return(await i.post("/api/discord/test-message",{channelId:a,content:o})).data}const A=G("discord",()=>{const a=c([]),o=c([]),l=c(""),u=c(!1),t=c(null),d=c(0),p=300*1e3,g=f(()=>{const e={};return a.value.forEach(n=>{const s=n.parentName||"未分類";e[s]||(e[s]=[]),e[s].push(n)}),Object.keys(e).forEach(n=>{e[n]?.sort((s,r)=>(s.position||0)-(r.position||0))}),e}),v=f(()=>a.value.filter(e=>e.type===0));async function h(e,n=!1){const s=Date.now();if(!n&&a.value.length>0&&s-d.value<p)return a.value;u.value=!0,t.value=null;try{const r=await M(e);return a.value=r.channels,l.value=r.guildId,d.value=s,r.channels}catch(r){throw t.value=r.response?.data?.message||"載入 Discord 頻道失敗",r}finally{u.value=!1}}async function y(){u.value=!0,t.value=null;try{const e=await I();return o.value=e.guilds,e.guilds}catch(e){throw t.value=e.response?.data?.message||"載入 Discord 伺服器列表失敗",e}finally{u.value=!1}}async function w(e,n){u.value=!0,t.value=null;try{return await b(e,n)}catch(s){throw t.value=s.response?.data?.message||"發送測試訊息失敗",s}finally{u.value=!1}}function C(e){return a.value.find(n=>n.id===e)}function m(e){return o.value.find(n=>n.id===e)}function D(){t.value=null}function E(){a.value=[],o.value=[],l.value="",d.value=0}return{channels:a,guilds:o,currentGuildId:l,isLoading:u,error:t,channelsByCategory:g,textChannels:v,fetchChannels:h,fetchGuilds:y,sendTestMessage:w,getChannelById:C,getGuildById:m,clearError:D,clearCache:E}});export{x as g,b as s,A as u};
