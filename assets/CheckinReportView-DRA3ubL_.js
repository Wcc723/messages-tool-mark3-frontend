import{A as j,d as N,c as P,m as S,r as d,o as I,a as s,b as e,e as U,t as o,F as u,h as y,N as V,g as $,v as B,O as L,l as M,i as R,j as a}from"./index-BRr86PQQ.js";async function F(g){return(await j.get(`/api/checkin/${g}/stats`)).data.data}async function K(g,p){return(await j.get(`/api/checkin/${g}/users`,{params:p})).data.data}const q={class:"space-y-6"},z={class:"flex items-center justify-between"},A={class:"flex items-center gap-4"},E={class:"text-2xl font-bold text-gray-800"},O={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700"},Q={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},G={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-5"},H={class:"flex items-center gap-3"},J={class:"text-2xl font-bold text-gray-800"},W={key:0,class:"text-gray-400"},X={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-5"},Y={class:"flex items-center gap-3"},Z={class:"text-2xl font-bold text-gray-800"},ee={key:0,class:"text-gray-400"},te={class:"mt-3 h-2 bg-gray-100 rounded-full overflow-hidden"},se={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-5"},ae={class:"flex items-center gap-3"},oe={class:"text-2xl font-bold text-gray-800"},le={key:0,class:"text-gray-400"},re={class:"text-sm font-normal text-gray-500"},ne={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-5"},ie={class:"flex items-center gap-3"},de={class:"text-2xl font-bold text-gray-800"},ce={key:0,class:"text-gray-400"},ue={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},ge={class:"p-4 border-b border-gray-200"},pe={class:"flex items-center gap-3"},xe={class:"relative flex-1 max-w-md"},ye={class:"overflow-x-auto"},ve={class:"min-w-full divide-y divide-gray-200"},be={class:"bg-white divide-y divide-gray-200"},he={key:0},fe={key:1},me={class:"px-6 py-4 whitespace-nowrap"},_e={class:"flex items-center gap-3"},we=["src","alt"],ke={key:1,class:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center"},Ce={class:"text-sm font-medium text-gray-800"},Pe={class:"text-xs text-gray-500"},Ue={class:"px-6 py-4 whitespace-nowrap"},je={class:"text-sm font-mono text-gray-600"},Te={class:"px-6 py-4 whitespace-nowrap"},De={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-emerald-100 text-emerald-800"},Ne={key:0,class:"px-4 py-3 border-t border-gray-200 flex items-center justify-between"},Se={class:"text-sm text-gray-500"},Ie={class:"flex items-center gap-2"},Ve=["disabled"],$e=["disabled"],Le=N({__name:"CheckinReportView",setup(g){const p=S(),m=R(),_=P(()=>p.params.id),n=d(null),v=d([]),r=d({currentPage:1,totalPages:1,totalCount:0,limit:50}),b=d(""),c=d(!1),h=d(!1),x=d(null);async function T(){c.value=!0,x.value=null;try{n.value=await F(_.value)}catch(i){x.value=i.response?.data?.message||"載入統計資料失敗",console.error("載入統計資料失敗:",i)}finally{c.value=!1}}async function f(i=1){h.value=!0;try{const t=await K(_.value,{page:i,limit:50,search:b.value||void 0});v.value=t.users,r.value=t.pagination}catch(t){console.error("載入用戶列表失敗:",t)}finally{h.value=!1}}function w(){f(1)}function k(i){i>=1&&i<=r.value.totalPages&&f(i)}function D(){m.push({name:"CheckinSchedules"})}const C=P(()=>!n.value||n.value.expectedTasks===0?0:Math.round(n.value.dailyTasks/n.value.expectedTasks*100));return I(()=>{T(),f()}),(i,t)=>(a(),s("div",q,[e("header",z,[e("div",A,[e("button",{type:"button",class:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition cursor-pointer",onClick:D},[...t[3]||(t[3]=[e("i",{class:"bi bi-arrow-left text-xl"},null,-1)])]),e("div",null,[e("h1",E,o(n.value?.scheduleName||"打卡報告"),1),t[4]||(t[4]=e("p",{class:"text-gray-600 mt-1"},"排程統計與用戶打卡情況",-1))])])]),x.value?(a(),s("div",O,o(x.value),1)):U("",!0),e("section",Q,[e("div",G,[e("div",H,[t[6]||(t[6]=e("div",{class:"w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center"},[e("i",{class:"bi bi-check2-all text-indigo-600 text-lg"})],-1)),e("div",null,[t[5]||(t[5]=e("p",{class:"text-sm text-gray-500"},"總打卡數",-1)),e("p",J,[c.value?(a(),s("span",W,"--")):(a(),s(u,{key:1},[y(o(n.value?.totalCheckins??0),1)],64))])])])]),e("div",X,[e("div",Y,[t[8]||(t[8]=e("div",{class:"w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center"},[e("i",{class:"bi bi-graph-up text-emerald-600 text-lg"})],-1)),e("div",null,[t[7]||(t[7]=e("p",{class:"text-sm text-gray-500"},"完成進度",-1)),e("p",Z,[c.value?(a(),s("span",ee,"--")):(a(),s(u,{key:1},[y(o(C.value)+"% ",1)],64))])])]),e("div",te,[e("div",{class:"h-full bg-emerald-500 rounded-full transition-all duration-300",style:V({width:`${C.value}%`})},null,4)])]),e("div",se,[e("div",ae,[t[10]||(t[10]=e("div",{class:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center"},[e("i",{class:"bi bi-chat-dots text-blue-600 text-lg"})],-1)),e("div",null,[t[9]||(t[9]=e("p",{class:"text-sm text-gray-500"},"討論串數",-1)),e("p",oe,[c.value?(a(),s("span",le,"--")):(a(),s(u,{key:1},[y(o(n.value?.dailyTasks??0)+" ",1),e("span",re," / "+o(n.value?.expectedTasks??0),1)],64))])])])]),e("div",ne,[e("div",ie,[t[12]||(t[12]=e("div",{class:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center"},[e("i",{class:"bi bi-people text-purple-600 text-lg"})],-1)),e("div",null,[t[11]||(t[11]=e("p",{class:"text-sm text-gray-500"},"參與人數",-1)),e("p",de,[c.value?(a(),s("span",ce,"--")):(a(),s(u,{key:1},[y(o(n.value?.uniqueUsers??0),1)],64))])])])])]),e("section",ue,[e("div",ge,[e("div",pe,[e("div",xe,[t[13]||(t[13]=e("i",{class:"bi bi-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"},null,-1)),$(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=l=>b.value=l),placeholder:"搜尋用戶名稱或 Discord ID...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",onKeyup:L(w,["enter"])},null,544),[[B,b.value]])]),e("button",{type:"button",class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition cursor-pointer",onClick:w}," 搜尋 ")])]),e("div",ye,[e("table",ve,[t[17]||(t[17]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"}," 用戶 "),e("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"}," Discord ID "),e("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"}," 打卡天數 ")])],-1)),e("tbody",be,[h.value?(a(),s("tr",he,[...t[14]||(t[14]=[e("td",{colspan:"3",class:"px-6 py-12 text-center"},[e("div",{class:"flex flex-col items-center gap-3"},[e("div",{class:"w-8 h-8 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin"}),e("span",{class:"text-gray-500"},"載入中...")])],-1)])])):v.value.length===0?(a(),s("tr",fe,[...t[15]||(t[15]=[e("td",{colspan:"3",class:"px-6 py-12 text-center text-gray-500"},[e("i",{class:"bi bi-person-x text-3xl text-gray-300 mb-2"}),e("p",null,"尚無打卡用戶")],-1)])])):(a(!0),s(u,{key:2},M(v.value,l=>(a(),s("tr",{key:l.discordUserId,class:"hover:bg-gray-50 transition"},[e("td",me,[e("div",_e,[l.avatarUrl?(a(),s("img",{key:0,src:l.avatarUrl,alt:l.displayName,class:"w-8 h-8 rounded-full"},null,8,we)):(a(),s("div",ke,[...t[16]||(t[16]=[e("i",{class:"bi bi-person text-gray-500"},null,-1)])])),e("div",null,[e("p",Ce,o(l.displayName),1),e("p",Pe,"@"+o(l.username),1)])])]),e("td",Ue,[e("span",je,o(l.discordUserId),1)]),e("td",Te,[e("span",De,o(l.totalCheckinDays)+" 天 ",1)])]))),128))])])]),r.value.totalPages>1?(a(),s("div",Ne,[e("p",Se," 共 "+o(r.value.totalCount)+" 位用戶，第 "+o(r.value.currentPage)+" / "+o(r.value.totalPages)+" 頁 ",1),e("div",Ie,[e("button",{type:"button",class:"px-3 py-1 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer",disabled:r.value.currentPage<=1,onClick:t[1]||(t[1]=l=>k(r.value.currentPage-1))}," 上一頁 ",8,Ve),e("button",{type:"button",class:"px-3 py-1 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer",disabled:r.value.currentPage>=r.value.totalPages,onClick:t[2]||(t[2]=l=>k(r.value.currentPage+1))}," 下一頁 ",8,$e)])])):U("",!0)])]))}});export{Le as default};
