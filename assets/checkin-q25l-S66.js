import{A as r,H as L,r as i}from"./index-BRr86PQQ.js";async function $(a){return(await r.post("/api/checkin-schedules",a)).data.data}async function B(a){return(await r.get("/api/checkin-schedules",{params:a})).data.data}async function R(a){return(await r.get(`/api/checkin-schedules/${a}`)).data.data}async function b(a,t){return(await r.patch(`/api/checkin-schedules/${a}`,t)).data.data}async function A(a){return(await r.delete(`/api/checkin-schedules/${a}`)).data}async function E(a){return(await r.patch(`/api/checkin-schedules/${a}/toggle`)).data.data}async function H(a,t){return(await r.post(`/api/checkin-schedules/${a}/rescan`,t)).data}async function j(a){return(await r.get(`/api/checkin-schedules/scan-status/${a}`)).data.data}async function q(a){return(await r.get(`/api/checkin-schedules/scan-result/${a}`)).data.data}const F=L("checkin",()=>{const a=i([]),t=i(null),u=i(!1),s=i(null),o=i(null);async function d(n){u.value=!0,s.value=null;try{const e=await B(n);return a.value=e,e}catch(e){throw s.value=e.response?.data?.message||"載入打卡排程列表失敗",e}finally{u.value=!1}}async function h(n){u.value=!0,s.value=null;try{const e=await R(n);return t.value=e,e}catch(e){throw s.value=e.response?.data?.message||"載入打卡排程失敗",e}finally{u.value=!1}}async function v(n){u.value=!0,s.value=null;try{const e=await $(n);return a.value.unshift(e),e}catch(e){throw s.value=e.response?.data?.message||"建立打卡排程失敗",e}finally{u.value=!1}}async function f(n,e){u.value=!0,s.value=null;try{const c=await b(n,e),l=a.value.findIndex(x=>x.id===n);return l!==-1&&(a.value[l]=c),t.value?.id===n&&(t.value=c),c}catch(c){throw s.value=c.response?.data?.message||"更新打卡排程失敗",c}finally{u.value=!1}}async function p(n){const e=a.value.findIndex(l=>l.id===n),c=e!==-1?a.value[e]:null;e!==-1&&a.value.splice(e,1),u.value=!0,s.value=null;try{await A(n),t.value?.id===n&&(t.value=null)}catch(l){throw c&&e!==-1&&a.value.splice(e,0,c),s.value=l.response?.data?.message||"刪除打卡排程失敗",l}finally{u.value=!1}}async function y(n){u.value=!0,s.value=null;try{const e=await E(n),c=a.value.findIndex(l=>l.id===n);return c!==-1&&(a.value[c]=e),t.value?.id===n&&(t.value=e),e}catch(e){throw s.value=e.response?.data?.message||"切換狀態失敗",e}finally{u.value=!1}}async function g(n,e){u.value=!0,s.value=null;try{const l=await H(n,e?{scanDate:e}:void 0);return l.data?.scanLogId&&(o.value={scanLogId:l.data.scanLogId,scheduleId:n,status:null,result:null}),l.data?.scanLogId}catch(c){throw s.value=c.response?.data?.message||"重新掃描失敗",c}finally{u.value=!1}}async function w(n){try{const e=await j(n);return o.value?.scanLogId===n&&(o.value.status=e),e}catch(e){throw s.value=e.response?.data?.message||"取得掃描狀態失敗",e}}async function S(n){try{const e=await q(n);return o.value?.scanLogId===n&&(o.value.result=e),e}catch(e){throw s.value=e.response?.data?.message||"取得掃描結果失敗",e}}function k(){o.value=null}function m(){t.value=null}function C(){s.value=null}function I(){a.value=[],t.value=null,o.value=null,s.value=null}return{schedules:a,currentSchedule:t,currentScanLog:o,isLoading:u,error:s,fetchSchedules:d,fetchScheduleById:h,createSchedule:v,updateSchedule:f,deleteSchedule:p,toggleSchedule:y,rescanSchedule:g,fetchScanStatus:w,fetchScanResult:S,clearScanLog:k,clearCurrentSchedule:m,clearError:C,reset:I}});export{F as u};
