import{d as H,z as J,r as n,c as b,C as K,o as O,a as s,b as e,h as E,f as L,e as i,t as r,s as N,D,F as j,l as S,w as Q,g as U,A as W,v as X,j as a}from"./index-BZWAi_Rm.js";import{u as Y,g as Z,s as ee}from"./discord-6cwmIzZL.js";const te={class:"max-w-7xl mx-auto"},se={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-8"},ae=["disabled"],oe={class:"bg-white border border-gray-200 rounded-lg p-6 mb-8"},le={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-6"},re={key:0,class:"text-sm text-red-600"},ne={class:"flex flex-col gap-6 sm:flex-row sm:items-center"},de={class:"flex items-center gap-4 flex-1"},ie=["src"],ce={class:"text-lg font-semibold text-gray-900"},ue={key:0},ge={key:1,class:"text-gray-500"},ve={class:"flex items-center gap-2 mt-2"},xe={class:"text-sm text-gray-700"},me={key:0,class:"text-xs text-gray-500"},ye={class:"grid grid-cols-2 gap-4 sm:w-auto"},be={class:"bg-gray-50 border border-gray-200 rounded-md px-4 py-3"},fe={class:"text-sm font-mono text-gray-900 mt-1"},pe={class:"bg-gray-50 border border-gray-200 rounded-md px-4 py-3"},_e={class:"text-sm font-semibold text-gray-900 mt-1"},he={class:"grid grid-cols-1 gap-8 lg:grid-cols-2 mb-8"},we={class:"bg-white border border-gray-200 rounded-lg p-6"},ke={class:"flex items-center gap-3 mb-4"},Ce={class:"text-sm text-gray-600"},Be={key:0,class:"mb-4 text-sm text-red-600"},De={key:1,class:"py-12 text-center text-sm text-gray-600"},je={key:2,class:"py-12 text-center text-sm text-gray-500"},Se={key:3,class:"space-y-2"},Ge=["onClick"],Ie={class:"flex-1"},Me={class:"text-sm font-medium text-gray-900"},Ve={class:"text-xs text-gray-500 mt-1"},Te={key:0,class:"bi bi-check-circle-fill text-base text-gray-900"},Ee={class:"bg-white border border-gray-200 rounded-lg p-6"},Le={class:"flex items-center gap-3 mb-4"},Ne={class:"text-sm text-gray-600"},Ue={key:0},$e={key:1},ze={key:0,class:"mb-4 text-sm text-red-600"},Ae={key:1,class:"py-12 text-center text-sm text-gray-500"},Fe={key:2,class:"py-12 text-center text-sm text-gray-600"},Re={key:3,class:"py-12 text-center text-sm text-gray-500"},Pe={key:4,class:"space-y-2 max-h-80 overflow-y-auto pr-1"},qe={class:"flex-1"},He={class:"text-sm font-medium text-gray-900"},Je={class:"text-xs text-gray-500 mt-1"},Ke={class:"flex items-center gap-2 text-xs text-gray-600"},Oe={key:0,class:"px-2 py-1 border border-gray-300 rounded"},Qe={key:1,class:"px-2 py-1 border border-gray-300 rounded"},We={class:"bg-white border border-gray-200 rounded-lg p-6"},Xe=["disabled"],Ye=["value"],Ze={class:"text-xs text-gray-500 mt-1"},et={key:0,class:"text-sm text-red-600"},tt={class:"flex justify-end"},st=["disabled"],at={key:0,class:"bi bi-hourglass-split"},ot={key:1,class:"bi bi-send"},dt=H({__name:"DiscordView",setup(lt){const C=Y(),{guilds:f,channels:G}=J(C),c=n(null),v=n("unknown"),I=n(0),p=n(!1),_=n(null),h=n(!1),w=n(null),d=n(""),B=n(!1),m=n(null),k=n(!1),u=n(""),x=n(""),y=n(null),$=b(()=>{if(!c.value)return"https://ui-avatars.com/api/?name=Discord+Bot&background=111827&color=fff";const{id:o,avatar:t,username:l}=c.value;return t?`https://cdn.discordapp.com/avatars/${o}/${t}.png`:`https://ui-avatars.com/api/?name=${encodeURIComponent(l||"Bot")}&background=111827&color=fff`}),z=b(()=>v.value==="connected"?"已連接":v.value==="disconnected"?"未連接":"未知"),A=b(()=>v.value==="connected"?"bg-green-500":v.value==="disconnected"?"bg-red-500":"bg-gray-400"),g=b(()=>G.value.filter(o=>o.type===0)),M=b(()=>f.value.find(o=>o.id===d.value)||null),F=async()=>{p.value=!0,_.value=null;try{const o=await Z();c.value=o.bot,v.value=o.status==="connected"?"connected":"disconnected",I.value=o.guildCount}catch(o){_.value=o.response?.data?.message||"無法取得 Bot 資訊",v.value="unknown"}finally{p.value=!1}},R=async()=>{h.value=!0,w.value=null;try{const o=await C.fetchGuilds();if(!d.value&&o.length>0){const t=o[0];t&&(d.value=t.id)}}catch(o){w.value=o.response?.data?.message||"載入伺服器列表失敗"}finally{h.value=!1}},V=async o=>{if(!o){m.value=null,u.value="",G.value=[];return}B.value=!0,m.value=null;try{await C.fetchChannels(o,!0),g.value.some(t=>t.id===u.value)||(u.value="")}catch(t){m.value=t.response?.data?.message||"載入頻道失敗"}finally{B.value=!1}},T=async()=>{await Promise.all([F(),R()])},P=async()=>{if(!u.value||!x.value.trim()){y.value="請選擇頻道並輸入訊息內容";return}y.value=null,k.value=!0;try{await ee(u.value,x.value.trim()),alert("測試訊息已發送"),x.value=""}catch(o){y.value=o.response?.data?.message||"發送測試訊息失敗"}finally{k.value=!1}};return K(d,o=>{V(o)}),O(async()=>{await T(),d.value&&await V(d.value)}),(o,t)=>(a(),s("div",te,[e("div",se,[t[3]||(t[3]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900 mb-2"},"Discord 設定"),e("p",{class:"text-gray-600"},"管理 Discord Bot 與伺服器頻道")],-1)),e("button",{type:"button",onClick:T,disabled:p.value||h.value,class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-100 transition-colors flex items-center gap-2 disabled:opacity-60 disabled:cursor-not-allowed"},[...t[2]||(t[2]=[e("i",{class:"bi bi-arrow-clockwise"},null,-1),E(" 重新整理 ",-1)])],8,ae)]),e("div",oe,[e("div",le,[t[4]||(t[4]=L('<div class="flex items-center gap-3"><div class="w-10 h-10 bg-gray-100 rounded-md flex items-center justify-center"><i class="bi bi-robot text-gray-600 text-lg"></i></div><div><h2 class="text-lg font-semibold text-gray-900">Bot 連線資訊</h2><p class="text-sm text-gray-600">檢視 Discord Bot 連線狀態與資訊</p></div></div>',1)),_.value?(a(),s("span",re,r(_.value),1)):i("",!0)]),e("div",ne,[e("div",de,[e("img",{src:$.value,alt:"Bot Avatar",class:"w-16 h-16 rounded-xl border border-gray-200"},null,8,ie),e("div",null,[e("p",ce,[c.value?(a(),s("span",ue,r(c.value.username)+"#"+r(c.value.discriminator),1)):(a(),s("span",ge,"未取得 Bot 資訊"))]),e("div",ve,[e("span",{class:N(["w-2.5 h-2.5 rounded-full",A.value])},null,2),e("span",xe,r(z.value),1),p.value?(a(),s("span",me,"更新中...")):i("",!0)])])]),e("div",ye,[e("div",be,[t[5]||(t[5]=e("p",{class:"text-xs text-gray-500"},"Bot ID",-1)),e("p",fe,r(c.value?.id||"—"),1)]),e("div",pe,[t[6]||(t[6]=e("p",{class:"text-xs text-gray-500"},"已加入伺服器",-1)),e("p",_e,r(I.value),1)])])])]),e("div",he,[e("div",we,[e("div",ke,[t[8]||(t[8]=e("div",{class:"w-10 h-10 bg-gray-100 rounded-md flex items-center justify-center"},[e("i",{class:"bi bi-buildings text-gray-600 text-lg"})],-1)),e("div",null,[t[7]||(t[7]=e("h2",{class:"text-lg font-semibold text-gray-900"},"伺服器列表",-1)),e("p",Ce,"共 "+r(D(f).length)+" 個伺服器",1)])]),w.value?(a(),s("div",Be,r(w.value),1)):i("",!0),h.value?(a(),s("div",De,"載入伺服器中...")):D(f).length===0?(a(),s("div",je," 尚未連接任何伺服器 ")):(a(),s("div",Se,[(a(!0),s(j,null,S(D(f),l=>(a(),s("button",{key:l.id,type:"button",onClick:q=>d.value=l.id,class:N(["w-full border rounded-md px-4 py-3 flex items-center gap-3 text-left transition-colors",d.value===l.id?"border-gray-900 bg-gray-100":"border-gray-300 hover:border-gray-400"])},[e("div",Ie,[e("p",Me,r(l.name),1),e("p",Ve,r(l.memberCount)+" 位成員",1)]),d.value===l.id?(a(),s("i",Te)):i("",!0)],10,Ge))),128))]))]),e("div",Ee,[e("div",Le,[t[10]||(t[10]=e("div",{class:"w-10 h-10 bg-gray-100 rounded-md flex items-center justify-center"},[e("i",{class:"bi bi-hash text-gray-600 text-lg"})],-1)),e("div",null,[t[9]||(t[9]=e("h2",{class:"text-lg font-semibold text-gray-900"},"頻道列表",-1)),e("p",Ne,[M.value?(a(),s("span",Ue,r(M.value.name)+" · "+r(g.value.length)+" 個頻道",1)):(a(),s("span",$e,"請選擇伺服器"))])])]),m.value?(a(),s("div",ze,r(m.value),1)):i("",!0),d.value?B.value?(a(),s("div",Fe," 載入頻道中... ")):g.value.length===0?(a(),s("div",Re," 目前沒有可發送訊息的文字頻道 ")):(a(),s("div",Pe,[(a(!0),s(j,null,S(g.value,l=>(a(),s("div",{key:l.id,class:"flex items-center gap-3 border border-gray-200 rounded-md px-4 py-3"},[t[11]||(t[11]=e("div",{class:"w-8 h-8 bg-gray-100 rounded-md flex items-center justify-center"},[e("i",{class:"bi bi-chat-dots text-gray-600 text-base"})],-1)),e("div",qe,[e("p",He,"#"+r(l.name),1),e("p",Je,"ID："+r(l.id),1)]),e("div",Ke,[l.permissions?.viewChannel?(a(),s("span",Oe," 可檢視 ")):i("",!0),l.permissions?.sendMessages?(a(),s("span",Qe," 可發送 ")):i("",!0)])]))),128))])):(a(),s("div",Ae," 請先選擇伺服器 "))])]),e("div",We,[t[16]||(t[16]=L('<div class="flex items-center gap-3 mb-4"><div class="w-10 h-10 bg-gray-100 rounded-md flex items-center justify-center"><i class="bi bi-send text-gray-600 text-lg"></i></div><div><h2 class="text-lg font-semibold text-gray-900">發送測試訊息</h2><p class="text-sm text-gray-600">向所選伺服器的頻道發送測試訊息</p></div></div>',1)),e("form",{onSubmit:Q(P,["prevent"]),class:"space-y-4 max-w-2xl"},[e("div",null,[t[13]||(t[13]=e("label",{for:"testChannel",class:"block text-sm font-medium text-gray-700 mb-2"},"選擇頻道",-1)),U(e("select",{id:"testChannel","onUpdate:modelValue":t[0]||(t[0]=l=>u.value=l),disabled:g.value.length===0,class:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-gray-900 disabled:bg-gray-100"},[t[12]||(t[12]=e("option",{value:"",disabled:""},"請選擇頻道",-1)),(a(!0),s(j,null,S(g.value,l=>(a(),s("option",{key:l.id,value:l.id}," #"+r(l.name),9,Ye))),128))],8,Xe),[[W,u.value]])]),e("div",null,[t[14]||(t[14]=e("label",{for:"testContent",class:"block text-sm font-medium text-gray-700 mb-2"},"訊息內容",-1)),U(e("textarea",{id:"testContent","onUpdate:modelValue":t[1]||(t[1]=l=>x.value=l),rows:"4",maxlength:"2000",class:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-gray-900 resize-none",placeholder:"輸入要發送的訊息內容"},null,512),[[X,x.value]]),e("p",Ze,r(x.value.length)+" / 2000 字元",1)]),y.value?(a(),s("div",et,r(y.value),1)):i("",!0),e("div",tt,[e("button",{type:"submit",disabled:k.value||g.value.length===0,class:"px-5 py-2 bg-gray-900 text-white rounded-md hover:bg-gray-800 transition-colors flex items-center gap-2 disabled:bg-gray-400 disabled:cursor-not-allowed"},[k.value?(a(),s("i",at)):(a(),s("i",ot)),t[15]||(t[15]=E(" 發送測試訊息 ",-1))],8,st)])],32)])]))}});export{dt as default};
