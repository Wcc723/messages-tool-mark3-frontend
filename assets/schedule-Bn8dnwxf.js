import{y as r,E as P,r as v}from"./index-BZWAi_Rm.js";async function T(t){return(await r.post("/api/schedules",t)).data.data}async function k(t){return(await r.get("/api/schedules",{params:t})).data.data}async function L(t){return(await r.get(`/api/schedules/${t}`)).data.data}async function B(t,n){return(await r.patch(`/api/schedules/${t}`,n)).data.data}async function E(t){return(await r.delete(`/api/schedules/${t}`)).data}async function b(t,n){return(await r.patch(`/api/schedules/${t}/status`,{status:n})).data.data}async function j(){return(await r.get("/api/schedules/timezones")).data.data}async function q(t,n){return(await r.get(`/api/schedules/${t}/logs`,{params:n})).data.data}const F=P("schedule",()=>{const t=v([]),n=v(null),o=v(null),h=v([]),s=v(!1),l=v(null),i=v({currentPage:1,totalPages:1,totalCount:0,limit:10});async function f(e){s.value=!0,l.value=null;try{const a=await k(e);return t.value=a.schedules,i.value=a.pagination,a}catch(a){throw l.value=a.response?.data?.message||"載入排程列表失敗",a}finally{s.value=!1}}async function p(e){s.value=!0,l.value=null;try{const a=await L(e);return n.value=a,a}catch(a){throw l.value=a.response?.data?.message||"載入排程失敗",a}finally{s.value=!1}}async function y(e){s.value=!0,l.value=null;try{const a=await T(e);return t.value.unshift(a),i.value.totalCount++,a}catch(a){throw l.value=a.response?.data?.message||"建立排程失敗",a}finally{s.value=!1}}async function S(e,a){s.value=!0,l.value=null;try{const u=await B(e,a),d=t.value.findIndex(c=>c.id===e);return d!==-1&&(t.value[d]=u),n.value?.id===e&&(n.value=u),u}catch(u){throw l.value=u.response?.data?.message||"更新排程失敗",u}finally{s.value=!1}}async function g(e,a){s.value=!0,l.value=null;try{const u=await b(e,a),d=t.value.findIndex(c=>c.id===e);return d!==-1&&(t.value[d]=u),n.value?.id===e&&(n.value=u),u}catch(u){throw l.value=u.response?.data?.message||"更新排程狀態失敗",u}finally{s.value=!1}}async function w(e){const a=t.value.findIndex(c=>c.id===e),u=a!==-1?t.value[a]:null,d=i.value.totalCount;a!==-1&&(t.value.splice(a,1),i.value.totalCount--),s.value=!0,l.value=null;try{await E(e),n.value?.id===e&&(n.value=null)}catch(c){throw u&&a!==-1&&(t.value.splice(a,0,u),i.value.totalCount=d),l.value=c.response?.data?.message||"刪除排程失敗",c}finally{s.value=!1}}function m(e){o.value={title:e.title,content:e.content,scheduleType:e.scheduleType,weekDay:e.weekDay,monthDay:e.monthDay,channelId:e.channelId,timezone:e.timezone,attachments:e.attachments,status:"draft"}}function C(){o.value=null}async function $(){if(h.value.length>0)return h.value;s.value=!0,l.value=null;try{const e=await j();return h.value=e,e}catch(e){throw l.value=e.response?.data?.message||"載入時區列表失敗",e}finally{s.value=!1}}async function x(e,a){s.value=!0,l.value=null;try{return await q(e,a)}catch(u){throw l.value=u.response?.data?.message||"載入執行記錄失敗",u}finally{s.value=!1}}function I(){n.value=null}function z(){l.value=null}function D(){t.value=[],n.value=null,o.value=null,h.value=[],l.value=null,i.value={currentPage:1,totalPages:1,totalCount:0,limit:10}}return{schedules:t,currentSchedule:n,copiedScheduleData:o,timezones:h,isLoading:s,error:l,pagination:i,fetchSchedules:f,fetchScheduleById:p,createSchedule:y,updateSchedule:S,updateScheduleStatus:g,deleteSchedule:w,setCopiedSchedule:m,clearCopiedSchedule:C,fetchTimezones:$,fetchScheduleLogs:x,clearCurrentSchedule:I,clearError:z,reset:D}});export{F as u};
