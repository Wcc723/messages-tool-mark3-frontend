import{d as P,L as q,c as v,r as x,o as G,a as i,b as t,e as d,h as g,E as f,F as $,l as R,t as r,w as H,s as m,g as C,C as V,v as J,i as K,j as n}from"./index-B3HAl1kx.js";import{u as O}from"./checkin-Z3-i4hFp.js";import{u as Q}from"./discord-BQkI6JFc.js";const W={class:"space-y-6"},X={class:"flex items-center justify-between"},Y={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},Z={class:"relative"},tt={class:"min-w-full divide-y divide-gray-200"},et={class:"bg-white divide-y divide-gray-200"},st={key:0},it={key:1},nt={colspan:"7",class:"px-6 py-10 text-center text-gray-500"},at={class:"flex flex-col items-center gap-2"},ot={class:"px-6 py-4 whitespace-nowrap"},lt={class:"text-sm font-semibold text-gray-800"},rt={class:"text-xs text-gray-500"},dt={class:"px-6 py-4 whitespace-nowrap"},ct={class:"text-sm text-gray-700"},ut={class:"px-6 py-4 whitespace-nowrap"},pt={class:"text-sm text-gray-700"},xt={class:"text-xs text-gray-500"},gt={class:"px-6 py-4"},yt={key:0,class:"flex flex-wrap gap-1"},bt={key:1,class:"text-sm text-gray-400"},vt={class:"px-6 py-4 whitespace-nowrap"},ft=["onClick"],mt={class:"px-6 py-4"},ht={class:"flex items-center gap-2"},wt=["title"],kt=["onClick"],_t={class:"px-6 py-4 whitespace-nowrap text-right"},Ct={class:"inline-flex items-center gap-2"},St=["onClick"],Dt=["onClick"],Mt=["onClick"],$t={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700"},Rt={class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4 p-6 space-y-4"},Vt={class:"space-y-4"},Et={class:"text-sm text-gray-600"},It={class:"font-semibold text-gray-800"},jt={class:"space-y-3"},Nt={key:0,class:"space-y-2"},Tt={class:"flex items-center justify-end gap-3 pt-4 border-t border-gray-200"},Lt=["disabled"],At=["disabled"],Bt={key:0,class:"bi bi-arrow-repeat animate-spin"},qt=P({__name:"CheckinScheduleListView",setup(Ut){const S=K(),o=O(),h=Q(),{hasPermission:w}=q(),D=v(()=>w("checkin","canCreate")),E=v(()=>w("checkin","canEdit")),I=v(()=>w("checkin","canDelete")),k=x(!1),y=x(""),_=x(""),l=x("all"),c=x(""),u=x(!1);function j(a){const e=h.channels.find(s=>s.id===a);return e?`#${e.name}`:"未知頻道"}async function N(a){try{await navigator.clipboard.writeText(a),alert("排程 ID 已複製到剪貼簿！")}catch(e){console.error("複製失敗:",e),alert("複製失敗，請手動複製")}}async function T(a,e){if(confirm(`確定要刪除排程「${e}」嗎？此操作無法復原。`))try{await o.deleteSchedule(a),alert("排程已刪除")}catch{alert(o.error||"刪除失敗")}}async function L(a){try{await o.toggleSchedule(a)}catch{alert(o.error||"切換狀態失敗")}}function A(a,e){y.value=a,_.value=e,l.value="all",c.value="",k.value=!0}function b(){k.value=!1,y.value="",_.value="",l.value="all",c.value=""}async function B(){if(l.value==="single"&&!c.value){alert("請選擇要掃描的日期");return}u.value=!0;try{l.value==="all"?(await o.rescanSchedule(y.value),alert("已開始重新掃描全部日期")):(await o.rescanSchedule(y.value,c.value),alert(`已開始重新掃描 ${c.value}`)),b()}catch{alert(o.error||"掃描失敗")}finally{u.value=!1}}function U(a){S.push({name:"CheckinScheduleEdit",params:{id:a}})}function M(){S.push({name:"CheckinScheduleCreate"})}const z=v(()=>(o.schedules?.length??0)>0);return G(async()=>{h.channels.length===0&&await h.fetchChannels().catch(()=>{});try{await o.fetchSchedules()}catch(a){console.error("載入排程失敗:",a)}}),(a,e)=>(n(),i("div",W,[t("header",X,[e[4]||(e[4]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-800"},"打卡排程管理"),t("p",{class:"text-gray-600 mt-1"},"管理 Discord 頻道的打卡排程設定")],-1)),D.value?(n(),i("button",{key:0,type:"button",class:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition cursor-pointer",onClick:M},[...e[3]||(e[3]=[t("i",{class:"bi bi-plus-circle"},null,-1),g(" 新增排程 ",-1)])])):d("",!0)]),t("section",Y,[t("div",Z,[t("table",tt,[e[13]||(e[13]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"}," 排程名稱 "),t("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"}," Discord 頻道 "),t("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"}," 日期範圍 "),t("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"}," 關鍵字 "),t("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"}," 狀態 "),t("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"}," 排程 ID "),t("th",{class:"px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider"}," 操作 ")])],-1)),t("tbody",et,[f(o).isLoading?(n(),i("tr",st,[...e[5]||(e[5]=[t("td",{colspan:"7",class:"px-6 py-16 text-center"},[t("div",{class:"flex flex-col items-center gap-3"},[t("div",{class:"relative"},[t("div",{class:"w-12 h-12 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin"})]),t("div",{class:"text-gray-600"},[t("p",{class:"font-medium"},"載入排程資料中"),t("p",{class:"text-sm text-gray-400 mt-1"},"請稍候...")])])],-1)])])):z.value?(n(!0),i($,{key:2},R(f(o).schedules||[],s=>(n(),i("tr",{key:s.id,class:"hover:bg-gray-50 transition"},[t("td",ot,[t("div",null,[t("p",lt,r(s.name),1),t("p",rt," 預期討論串: "+r(s.expectedThreadCount||"-")+" 個 ",1)])]),t("td",dt,[t("p",ct,r(j(s.channelId)),1)]),t("td",ut,[t("div",pt,[t("div",null,r(s.startDate),1),t("div",xt,"至 "+r(s.endDate),1)])]),t("td",gt,[s.keywords&&s.keywords.length>0?(n(),i("div",yt,[(n(!0),i($,null,R(s.keywords,(p,F)=>(n(),i("span",{key:F,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800"},r(p),1))),128))])):(n(),i("span",bt,"全部訊息"))]),t("td",vt,[t("button",{type:"button",class:m(["inline-flex items-center gap-2 text-sm font-medium cursor-pointer",s.isActive?"text-emerald-600":"text-gray-400"]),onClick:p=>L(s.id)},[t("span",{class:m(["w-2 h-2 rounded-full",s.isActive?"bg-emerald-500":"bg-gray-400"])},null,2),g(" "+r(s.isActive?"啟用":"停用"),1)],10,ft)]),t("td",mt,[t("div",ht,[t("span",{class:"text-xs font-mono text-gray-600 truncate max-w-[100px]",title:s.id},r(s.id),9,wt),t("button",{type:"button",class:"text-gray-400 hover:text-gray-600 transition cursor-pointer",title:"複製排程 ID",onClick:p=>N(s.id)},[...e[9]||(e[9]=[t("i",{class:"bi bi-clipboard text-sm"},null,-1)])],8,kt)])]),t("td",_t,[t("div",Ct,[t("button",{type:"button",class:"p-2 text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition cursor-pointer",title:"重新掃描",onClick:p=>A(s.id,s.name)},[...e[10]||(e[10]=[t("i",{class:"bi bi-arrow-clockwise"},null,-1)])],8,St),E.value?(n(),i("button",{key:0,type:"button",class:"p-2 text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition cursor-pointer",title:"編輯",onClick:p=>U(s.id)},[...e[11]||(e[11]=[t("i",{class:"bi bi-pencil"},null,-1)])],8,Dt)):d("",!0),I.value?(n(),i("button",{key:1,type:"button",class:"p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition cursor-pointer",title:"刪除",onClick:p=>T(s.id,s.name)},[...e[12]||(e[12]=[t("i",{class:"bi bi-trash"},null,-1)])],8,Mt)):d("",!0)])])]))),128)):(n(),i("tr",it,[t("td",nt,[t("div",at,[e[7]||(e[7]=t("i",{class:"bi bi-clipboard-check text-3xl text-gray-300"},null,-1)),e[8]||(e[8]=t("span",null,"尚無打卡排程",-1)),D.value?(n(),i("button",{key:0,type:"button",class:"mt-2 inline-flex items-center gap-2 px-4 py-2 text-sm bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition cursor-pointer",onClick:M},[...e[6]||(e[6]=[t("i",{class:"bi bi-plus-circle"},null,-1),g(" 建立第一個排程 ",-1)])])):d("",!0)])])]))])])])]),f(o).error?(n(),i("div",$t,r(f(o).error),1)):d("",!0),k.value?(n(),i("div",{key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:H(b,["self"])},[t("div",Rt,[t("div",{class:"flex items-center justify-between border-b border-gray-200 pb-3"},[e[15]||(e[15]=t("h3",{class:"text-lg font-semibold text-gray-800"},"重新掃描排程",-1)),t("button",{type:"button",class:"text-gray-400 hover:text-gray-600 transition",onClick:b},[...e[14]||(e[14]=[t("i",{class:"bi bi-x-lg text-xl"},null,-1)])])]),t("div",Vt,[t("p",Et,[e[16]||(e[16]=g(" 排程：",-1)),t("span",It,r(_.value),1)]),t("div",jt,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700"},"掃描範圍",-1)),t("label",{class:m(["flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition",l.value==="all"?"border-indigo-500 bg-indigo-50":"border-gray-300"])},[C(t("input",{type:"radio","onUpdate:modelValue":e[0]||(e[0]=s=>l.value=s),value:"all",class:"w-4 h-4 text-indigo-600"},null,512),[[V,l.value]]),e[17]||(e[17]=t("div",{class:"flex-1"},[t("div",{class:"font-medium text-gray-800"},"掃描全部日期"),t("div",{class:"text-xs text-gray-500"},"重新掃描排程內所有日期的討論串")],-1))],2),t("label",{class:m(["flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition",l.value==="single"?"border-indigo-500 bg-indigo-50":"border-gray-300"])},[C(t("input",{type:"radio","onUpdate:modelValue":e[1]||(e[1]=s=>l.value=s),value:"single",class:"w-4 h-4 text-indigo-600"},null,512),[[V,l.value]]),e[18]||(e[18]=t("div",{class:"flex-1"},[t("div",{class:"font-medium text-gray-800"},"掃描單一日期"),t("div",{class:"text-xs text-gray-500"},"指定特定日期進行掃描")],-1))],2)]),l.value==="single"?(n(),i("div",Nt,[e[20]||(e[20]=t("label",{for:"rescanDate",class:"block text-sm font-medium text-gray-700"},[g(" 選擇日期 "),t("span",{class:"text-red-500"},"*")],-1)),C(t("input",{id:"rescanDate",type:"date","onUpdate:modelValue":e[2]||(e[2]=s=>c.value=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,512),[[J,c.value]])])):d("",!0)]),t("div",Tt,[t("button",{type:"button",class:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition disabled:opacity-50",disabled:u.value,onClick:b}," 取消 ",8,Lt),t("button",{type:"button",class:"px-4 py-2 text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 transition disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2",disabled:u.value,onClick:B},[u.value?(n(),i("i",Bt)):d("",!0),t("span",null,r(u.value?"掃描中...":"開始掃描"),1)],8,At)])])])):d("",!0)]))}});export{qt as default};
