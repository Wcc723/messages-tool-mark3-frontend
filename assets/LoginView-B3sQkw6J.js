import{d as B,u as D,r as n,c as S,o as E,a as g,b as o,e as b,f as L,t as v,w as M,g as f,v as w,h as q,i as z,j as m}from"./index-B3HAl1kx.js";const I={class:"min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 flex items-center justify-center p-4"},j={class:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-8"},K={class:"text-center mb-8"},N={class:"text-gray-600"},A={key:0,class:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg"},U={class:"text-red-600 text-sm"},R={key:0},T=["required","disabled"],H=["disabled"],F=["disabled"],J=["disabled"],O={key:0,class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},P={class:"mt-6 text-center"},Q=["disabled"],Y=B({__name:"LoginView",setup(W){const x=z(),s=D(),d=n(""),a=n(""),c=n(""),l=n(!1),t=n(null),p=n(null),i=S(()=>s.isLoading),y=S(()=>t.value||s.error),k="488191419054-r7gckuulfhiudhgc2itngdqnuv1t33ri.apps.googleusercontent.com",C=async()=>{if(t.value=null,s.clearError(),!d.value||!a.value){t.value="請填寫所有必填欄位";return}if(l.value&&!c.value){t.value="請填寫姓名";return}if(a.value.length<6){t.value="密碼至少需要 6 個字元";return}try{l.value?await s.register({email:d.value,password:a.value,name:c.value}):await s.login({email:d.value,password:a.value}),x.push("/dashboard")}catch(r){console.error("Authentication error:",r)}},G=async r=>{t.value=null,s.clearError();try{await s.googleLogin(r.credential)&&x.push("/dashboard")}catch(e){console.error("Google login error:",e),t.value=e.message||"Google 登入失敗"}};let h=!1;const _=()=>{if(!h){if(!window.google?.accounts?.id){console.error("Google Identity Services SDK not available");return}window.google.accounts.id.initialize({client_id:k,callback:G,auto_select:!1}),p.value&&window.google.accounts.id.renderButton(p.value,{type:"standard",theme:"outline",size:"large",text:"signin_with",shape:"rectangular",logo_alignment:"left",width:400}),h=!0}};E(()=>{if(window.google?.accounts?.id){_();return}const r=document.querySelector('script[src="https://accounts.google.com/gsi/client"]');if(!r){console.error("Google Identity Services SDK script tag missing"),t.value="找不到 Google 登入所需的 SDK";return}r.addEventListener("load",()=>{_()},{once:!0}),r.addEventListener("error",()=>{console.error("Google Identity Services SDK failed to load"),t.value="Google 登入服務載入失敗，請稍後再試"},{once:!0})});const V=()=>{l.value=!l.value,t.value=null,s.clearError()};return(r,e)=>(m(),g("div",I,[o("div",j,[o("div",K,[e[3]||(e[3]=o("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},"Discord 訊息排程工具",-1)),o("p",N,v(l.value?"建立新帳號":"登入您的帳號"),1)]),y.value?(m(),g("div",A,[o("p",U,v(y.value),1)])):b("",!0),o("form",{onSubmit:M(C,["prevent"]),class:"space-y-4"},[l.value?(m(),g("div",R,[e[4]||(e[4]=o("label",{for:"name",class:"block text-sm font-medium text-gray-700 mb-1"},"姓名",-1)),f(o("input",{id:"name","onUpdate:modelValue":e[0]||(e[0]=u=>c.value=u),type:"text",required:l.value,disabled:i.value,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"輸入您的姓名"},null,8,T),[[w,c.value]])])):b("",!0),o("div",null,[e[5]||(e[5]=o("label",{for:"email",class:"block text-sm font-medium text-gray-700 mb-1"},"電子郵件",-1)),f(o("input",{id:"email","onUpdate:modelValue":e[1]||(e[1]=u=>d.value=u),type:"email",required:"",disabled:i.value,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"example@email.com"},null,8,H),[[w,d.value]])]),o("div",null,[e[6]||(e[6]=o("label",{for:"password",class:"block text-sm font-medium text-gray-700 mb-1"},"密碼",-1)),f(o("input",{id:"password","onUpdate:modelValue":e[2]||(e[2]=u=>a.value=u),type:"password",required:"",minlength:"6",disabled:i.value,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"至少 6 字元"},null,8,F),[[w,a.value]])]),o("button",{type:"submit",disabled:i.value,class:"w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition font-medium cursor-pointer disabled:bg-indigo-400 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[i.value?(m(),g("svg",O,[...e[7]||(e[7]=[o("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),o("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):b("",!0),q(" "+v(i.value?"處理中...":l.value?"註冊":"登入"),1)],8,J)],32),e[8]||(e[8]=L('<div class="relative my-6"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-300"></div></div><div class="relative flex justify-center text-sm"><span class="px-2 bg-white text-gray-500">或</span></div></div>',1)),o("div",{ref_key:"googleButtonContainer",ref:p,class:"flex justify-center"},null,512),o("div",P,[o("button",{onClick:V,disabled:i.value,class:"text-indigo-600 hover:text-indigo-800 text-sm font-medium cursor-pointer disabled:text-indigo-400 disabled:cursor-not-allowed"},v(l.value?"已有帳號？立即登入":"沒有帳號？立即註冊"),9,Q)])])]))}});export{Y as default};
