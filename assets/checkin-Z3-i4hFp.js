import{y as r,G as C,r as i}from"./index-B3HAl1kx.js";async function m(a){return(await r.post("/api/checkin-schedules",a)).data.data}async function x(a){return(await r.get("/api/checkin-schedules",{params:a})).data.data}async function I(a){return(await r.get(`/api/checkin-schedules/${a}`)).data.data}async function $(a,n){return(await r.patch(`/api/checkin-schedules/${a}`,n)).data.data}async function B(a){return(await r.delete(`/api/checkin-schedules/${a}`)).data}async function b(a){return(await r.patch(`/api/checkin-schedules/${a}/toggle`)).data.data}async function E(a,n){return(await r.post(`/api/checkin-schedules/${a}/rescan`,n)).data}const L=C("checkin",()=>{const a=i([]),n=i(null),l=i(!1),u=i(null);async function o(t){l.value=!0,u.value=null;try{const e=await x(t);return a.value=e,e}catch(e){throw u.value=e.response?.data?.message||"載入打卡排程列表失敗",e}finally{l.value=!1}}async function d(t){l.value=!0,u.value=null;try{const e=await I(t);return n.value=e,e}catch(e){throw u.value=e.response?.data?.message||"載入打卡排程失敗",e}finally{l.value=!1}}async function h(t){l.value=!0,u.value=null;try{const e=await m(t);return a.value.unshift(e),e}catch(e){throw u.value=e.response?.data?.message||"建立打卡排程失敗",e}finally{l.value=!1}}async function v(t,e){l.value=!0,u.value=null;try{const s=await $(t,e),c=a.value.findIndex(k=>k.id===t);return c!==-1&&(a.value[c]=s),n.value?.id===t&&(n.value=s),s}catch(s){throw u.value=s.response?.data?.message||"更新打卡排程失敗",s}finally{l.value=!1}}async function f(t){const e=a.value.findIndex(c=>c.id===t),s=e!==-1?a.value[e]:null;e!==-1&&a.value.splice(e,1),l.value=!0,u.value=null;try{await B(t),n.value?.id===t&&(n.value=null)}catch(c){throw s&&e!==-1&&a.value.splice(e,0,s),u.value=c.response?.data?.message||"刪除打卡排程失敗",c}finally{l.value=!1}}async function p(t){l.value=!0,u.value=null;try{const e=await b(t),s=a.value.findIndex(c=>c.id===t);return s!==-1&&(a.value[s]=e),n.value?.id===t&&(n.value=e),e}catch(e){throw u.value=e.response?.data?.message||"切換狀態失敗",e}finally{l.value=!1}}async function y(t,e){l.value=!0,u.value=null;try{await E(t,e?{scanDate:e}:void 0)}catch(s){throw u.value=s.response?.data?.message||"重新掃描失敗",s}finally{l.value=!1}}function w(){n.value=null}function g(){u.value=null}function S(){a.value=[],n.value=null,u.value=null}return{schedules:a,currentSchedule:n,isLoading:l,error:u,fetchSchedules:o,fetchScheduleById:d,createSchedule:h,updateSchedule:v,deleteSchedule:f,toggleSchedule:p,rescanSchedule:y,clearCurrentSchedule:w,clearError:g,reset:S}});export{L as u};
